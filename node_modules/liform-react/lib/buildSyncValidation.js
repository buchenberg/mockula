'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.setError = undefined;

var _ajv = require('ajv');

var _ajv2 = _interopRequireDefault(_ajv);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var setError = function setError(errors, error) {
    var dataPathParts = error.dataPath.split('.').slice(1);

    dataPathParts.reduce(function (errors, part, index) {
        if (index === dataPathParts.length - 1) {
            errors[part] = error.message;
        }
        if (!errors[part]) {
            errors[part] = {};
        }
        return errors[part];
    }, errors);
    return errors;
};

var buildSyncValidation = function buildSyncValidation(schema) {
    var ajv = new _ajv2.default({ errorDataPath: 'property', allErrors: true });
    return function (values) {
        var errors = {};
        var valid = ajv.validate(schema, values);
        if (valid) {
            return {};
        }
        var ajvErrors = ajv.errors;

        ajvErrors.forEach(function (error) {
            setError(errors, error);
        });
        return errors;
    };
};

exports.default = buildSyncValidation;
exports.setError = setError;